<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Snake â€” Classic HTML Game</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#22c55e;--muted:#94a3b8}
    *{box-sizing:border-box}
    /* Set body overflow to hidden and adjusted wrap padding */
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--bg),#071021);color:#e6eef8; overflow: hidden;}
    .wrap{
        min-height:100vh;
        display:flex;
        /* Default: Center content vertically on desktop */
        align-items:center;
        justify-content:center;
        padding:12px; 
    }
    .card{
        background:rgba(255,255,255,0.03);
        padding:18px; 
        border-radius:12px;
        box-shadow:0 6px 24px rgba(2,6,23,0.6);
        display:flex;
        gap: 30px; 
        align-items: flex-start; 
        justify-content: center; 
    }
    canvas{
        background:linear-gradient(180deg,#071422,#08202b);
        border-radius:8px;
        display:block;
        transition: box-shadow 0.2s ease-out; 
    }
    .hud{
        display:flex;
        flex-direction:column;
        gap:10px;
        min-width:180px;
        /* Manually push the HUD down to visually align its center with the 480px canvas center */
        margin-top: 65px; 
    }
    .hud .row{display:flex;justify-content:space-between;align-items:center}
    .btn{background:transparent;border:1px solid rgba(255,255,255,0.07);padding:8px 10px;border-radius:8px;color:var(--muted);cursor:pointer; transition: background 0.1s}
    .btn.primary{border-color:var(--accent);color:var(--accent)}
    .btn.danger{border-color:#ef4444;color:#ef4444} 
    .btn.danger:hover{background: rgba(239, 68, 68, 0.1);}
    .btn.success{border-color:var(--accent);color:#fff;background:var(--accent)} 
    .hint{font-size:13px;color:var(--muted)}
    .big{font-size:20px;font-weight:600}

    .big, #score, #best {
        transition: color 0.2s ease-out;
    }
    
    .red-warning {
        color: #ff4444;
        font-weight: 600;
        text-transform: uppercase;
    }
    .green-control {
        color: var(--accent);
        font-weight: 600;
    }
    
    /* MOBILE STYLES START */
    @media(max-width:720px){
        .wrap{
            /* ELIMINATE SPACE: Remove all outer padding */
            padding: 0; 
            /* ELIMINATE SPACE: Align content to the top instead of centering */
            align-items: flex-start;
        }
        .card{
            flex-direction:column;
            /* ELIMINATE SPACE: Reduce card padding (just enough for visual margin) */
            padding: 8px; 
            gap: 12px;
            align-items: center; 
            /* Ensure card takes full width for responsive layout */
            width: 100%;
            /* ELIMINATE SPACE: Remove box shadow so it doesn't create extra scroll space */
            box-shadow: none; 
            background: transparent; /* Card background is unnecessary when using full width */
        }
        .hud{
            width: 100%; 
            max-width: 480px; 
            margin-top: 0; 
            /* Tighter gap between score rows */
            gap: 5px; 
            /* ðŸ”¥ FIX 2: Remove top padding from HUD to pull score rows up immediately after mobile buttons */
            padding: 0 0 10px 0; 
        }
        .hud .row{
            font-size: 16px; 
        }
        .hud .row .big {
            font-size: 16px; 
        }
        /* Constrain the width of the score rows and the button container */
        .hud .row, .hud-footer, #mobile-reset-all-container {
            max-width: 300px; 
            width: 100%;
            margin-left: auto;
            margin-right: auto;
        }
        .hud-footer {
            align-items: center;
            margin-top: 5px; 
            padding-top: 5px;
        }
        /* Make canvas fluid on small screens */
        canvas {
            width: 90vw; 
            height: 90vw; 
            max-width: 480px; 
            max-height: 480px;
        }
        .playwrap {
            margin-top: 0; 
            /* ðŸ”¥ FIX 1: Remove bottom padding from playwrap to pull the score section up */
            padding-bottom: 0; 
            width: 100%;
        }
        .controls {
            /* Keep margin top for separation from canvas, but remove margin bottom */
            margin: 15px auto 0;
        }
        
        /* Hide the Desktop Title and Hints in the HUD on mobile */
        .hud > .desktop-title, .hud > .hint { 
             display: none !important; 
        }
        
        /* Show the mobile title above the canvas */
        .playwrap .mobile-title {
            display: block !important;
            margin-bottom: 8px; /* Slightly reduced margin */
        }

        /* Mobile Buttons Row (Start/Reset) */
        #mobile-buttons-row {
            display: flex;
            gap: 8px;
            max-width: 300px;
            width: 100%;
            /* Remove margin-top to pull this section right up to the controls */
            margin: 0 auto 10px auto; 
            padding: 10px 0 0 0;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        /* ðŸ”¥ FIX 3: Mobile Button for Reset All is now tight against the score/speed rows */
        #mobile-reset-all-container {
            display: flex;
            /* Added margin-top to separate it slightly from the Speed row */
            margin: 10px auto 0 auto; 
            padding-top: 5px; 
            border-top: 1px solid rgba(255, 255, 255, 0.05); 
        }
        
        /* Make all buttons in the row equal width */
        #mobile-buttons-row .btn, #mobile-reset-all-container .btn {
            flex-grow: 1;
            width: 100%;
        }

        /* Hide the desktop-only reset-all container on mobile */
        .hud-footer {
            display: none; 
        }
    }
    
    /* Hide mobile-specific containers on desktop */
    #mobile-buttons-row, #mobile-reset-all-container, .playwrap .mobile-title {
        display: none;
    }
    
    .playwrap{display:flex;flex-direction:column;align-items:center;gap:8px}
    .title{
        font-size:28px;
        font-weight:700;
        color: #e6eef8; 
        text-shadow: 0 0 8px rgba(230, 238, 248, 0.3); 
        margin-bottom:4px;
        text-align:center;
        transition: color 0.2s ease-out, text-shadow 0.2s ease-out; 
    }
    
    .hud-footer{
        display:flex;
        flex-direction:column;
        gap: 10px;
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
    }

    /* CUSTOM MODAL STYLES START */
    #confirm-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none; 
        justify-content: center;
        align-items: center;
        z-index: 1000;
        backdrop-filter: blur(4px);
    }
    .modal-content {
        background: var(--card);
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        max-width: 350px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    .modal-content p {
        margin: 0;
        font-size: 16px;
        font-weight: 500;
        line-height: 1.4;
    }
    .modal-buttons {
        display: flex;
        justify-content: space-around;
        gap: 10px;
    }
    .modal-buttons .btn {
        flex-grow: 1;
        padding: 10px;
        font-size: 16px;
    }
    /* CUSTOM MODAL STYLES END */
    
    /* MOBILE CONTROLS STYLES */
    .controls {
        display: grid;
        grid-template-areas: ". up ." "left center right" ". down .";
        gap: 8px;
        width: 150px; 
        margin: 20px auto 0;
    }
    .control-btn {
        grid-area: var(--area);
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--accent);
        cursor: pointer;
        transition: background 0.1s, transform 0.05s;
        -webkit-tap-highlight-color: transparent; 
    }
    .control-btn:active,
    .control-btn.key-press-simulated { 
        background: rgba(34, 197, 94, 0.2);
        transform: scale(0.95);
    }

    /* Assign grid areas */
    #up-btn { --area: up; }
    #down-btn { --area: down; }
    #left-btn { --area: left; }
    #right-btn { --area: right; }
    
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="playwrap">
        <div class="title mobile-title">Byte Serpent</div>
        
        <canvas id="game" width="480" height="480"></canvas>
        
        <div class="controls">
            <button id="up-btn" class="control-btn" data-dir="up">â–²</button>
            <div id="center-spacer" style="grid-area: center; visibility: hidden;"></div>
            <button id="left-btn" class="control-btn" data-dir="left">â—€</button>
            <button id="right-btn" class="control-btn" data-dir="right">â–¶</button>
            <button id="down-btn" class="control-btn" data-dir="down">â–¼</button>
        </div>
        
      </div>
      <div id="mobile-buttons-row">
          <button id="start-mobile" class="btn primary">Start</button>
          <button id="reset-mobile" class="btn">Reset</button>
      </div>
      
      <div class="hud">
        <div class="title desktop-title">Byte Serpent</div>
        <div class="row"><div class="big">Score</div><div id="score">0</div></div>
        <div class="row"><div class="big">Best</div><div id="best">0</div></div>
        <div class="row"><div class="hint">Speed</div><div id="speed">6</div></div>
        
        <div id="mobile-reset-all-container">
            <button id="reset-all-mobile" class="btn danger">Reset All</button>
        </div>

        <div id="desktop-buttons" style="display:flex;gap:8px">
          <button id="start" class="btn primary">Start</button>
          <button id="reset" class="btn">Reset</button>
        </div>
        <div class="hint">Controls: <span class="green-control">Arrow keys</span> / <span class="green-control">WASD</span></div>
        <div class="hint">Try to eat the <span class="red-warning">RED FOOD</span>. Don't hit the <span class="red-warning">WALLS</span> or <span class="red-warning">YOURSELF</span>.</div>
        
        <div class="hud-footer">
            <button id="reset-all-desktop" class="btn danger">Reset All</button>
        </div>
        </div>
    </div>
  </div>
  
  <div id="confirm-modal">
    <div class="modal-content">
        <p>Are you sure you want to wipe your Best Score?</p>
        <p class="hint" style="color: #ef4444; font-weight: 600;">THIS ACTION CANNOT BE UNDONE.</p>
        <div class="modal-buttons">
            <button id="confirm-no" class="btn">No</button>
            <button id="confirm-yes" class="btn success">Yes, Reset All</button>
        </div>
    </div>
  </div>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const scoreEl = document.getElementById('score');
const bestEl = document.getElementById('best');
const speedEl = document.getElementById('speed');

// Desktop Buttons
const startBtn = document.getElementById('start');
const resetBtn = document.getElementById('reset');

// Mobile Buttons (New IDs)
const startMobileBtn = document.getElementById('start-mobile');
const resetMobileBtn = document.getElementById('reset-mobile');

// Reset All Buttons
const resetAllDesktopBtn = document.getElementById('reset-all-desktop');
const resetAllMobileBtn = document.getElementById('reset-all-mobile');


// Title Elements
const desktopTitleEl = document.querySelector('.desktop-title');Â 
const mobileTitleEl = document.querySelector('.mobile-title');Â 


// Custom Modal elements
const confirmModal = document.getElementById('confirm-modal');
const confirmYesBtn = document.getElementById('confirm-yes');
const confirmNoBtn = document.getElementById('confirm-no');

// Get score/best labels
const scoreLabelEl = scoreEl.parentElement.querySelector('.big');
const bestLabelEl = bestEl.parentElement.querySelector('.big');

// New Control elements
const controlBtns = document.querySelectorAll('.control-btn');
// Map keyboard keys to control button IDs
const keyMap = {
Â  Â  'ArrowUp': 'up-btn', 'w': 'up-btn', 'W': 'up-btn',
Â  Â  'ArrowDown': 'down-btn', 's': 'down-btn', 'S': 'down-btn',
Â  Â  'ArrowLeft': 'left-btn', 'a': 'left-btn', 'A': 'left-btn',
Â  Â  'ArrowRight': 'right-btn', 'd': 'right-btn', 'D': 'right-btn'
};

const gridSize = 20;
const cols = canvas.width / gridSize;
const rows = canvas.height / gridSize;

let snake;
let dir;
let nextDir;
let food;

let tickInterval;
let tickTimer = null;

let running = false;
let dead = false;

let score = 0;
let best = Number(localStorage.getItem('snake_best') || 0);
bestEl.textContent = best;

// Function to handle direction setting (used by both keyboard and buttons)
function setDirection(newDir) {
Â  nextDir = newDir;
Â  
Â  // --- MODIFICATION START ---
Â  if (dead) {
Â  Â  // If dead, the first direction press just resets the game and waits for a second input to start.
Â  Â  resetGame();
Â  Â  // DO NOT call startGame() here.
Â  } else if (!running) {
Â  Â  // If not running (but not dead, e.g., first start or after a manual reset), a direction press starts the game.
Â  Â  startGame();
Â  }
Â  // --- MODIFICATION END ---
}

// Function to simulate the click animation
function simulateKeyPress(key) {
Â  Â  const btnId = keyMap[key];
Â  Â  if (btnId) {
Â  Â  Â  Â  const btn = document.getElementById(btnId);
Â  Â  Â  Â  if (btn) {
Â  Â  Â  Â  Â  Â  btn.classList.add('key-press-simulated');
Â  Â  Â  Â  Â  Â  // Remove the class after a short delay (e.g., 100ms)
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.remove('key-press-simulated');
Â  Â  Â  Â  Â  Â  }, 100);
Â  Â  Â  Â  }
Â  Â  }
}

// --- Event Listeners for Custom Controls (On-Screen Buttons) ---
controlBtns.forEach(btn => {
Â  Â  btn.addEventListener('click', (e) => {
Â  Â  Â  Â  const direction = e.currentTarget.getAttribute('data-dir');
Â  Â  Â  Â  let newDir = null;
Â  Â  Â  Â Â 
Â  Â  Â  Â  switch (direction) {
Â  Â  Â  Â  Â  Â  case 'up': newDir = { x: 0, y: -1 }; break;
Â  Â  Â  Â  Â  Â  case 'down': newDir = { x: 0, y: 1 }; break;
Â  Â  Â  Â  Â  Â  case 'left': newDir = { x: -1, y: 0 }; break;
Â  Â  Â  Â  Â  Â  case 'right': newDir = { x: 1, y: 0 }; break;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (newDir) {
Â  Â  Â  Â  Â  Â  setDirection(newDir);
Â  Â  Â  Â  }
Â  Â  });
});


// Function to reset all data (including high score) - Triggered by modal 'Yes'
function executeResetAll() {
Â  Â  // 1. Clear best score from local storage
Â  Â  localStorage.removeItem('snake_best');
Â  Â Â 
Â  Â  // 2. Reset the best variable
Â  Â  best = 0;
Â  Â Â 
Â  Â  // 3. Reset the current game
Â  Â  resetGame();

Â  Â  // 4. Hide the modal
Â  Â  confirmModal.style.display = 'none';
}

// Function to show the custom confirmation modal - Triggered by 'Reset All' button
function showResetAllConfirmation() {
Â  Â  confirmModal.style.display = 'flex';
}

// RESET GAME
function resetGame(){
Â  snake = [{ x: Math.floor(cols/2), y: Math.floor(rows/2) }];
Â  dir = {x:1, y:0};
Â  nextDir = {x:1, y:0};

Â  placeFood();
Â  score = 0;
Â  tickInterval = 1000 / 6;

Â  running = false;
Â  dead = false;

Â  clearInterval(tickTimer);
Â  updateHud();
Â Â 
Â  // Reset styles on game reset
Â  desktopTitleEl.style.color = '';
Â  desktopTitleEl.style.textShadow = '';
Â  mobileTitleEl.style.color = '';Â 
Â  mobileTitleEl.style.textShadow = '';Â 
Â  canvas.style.boxShadow = '';
Â Â 
Â  // Set ALL elements to "alive" green color (var(--accent) is #22c55e)
Â  scoreLabelEl.style.color = 'var(--accent)';
Â  scoreEl.style.color = 'var(--accent)';
Â  bestLabelEl.style.color = 'var(--accent)';
Â  bestEl.style.color = 'var(--accent)';
Â Â 
Â  draw();
}

function placeFood(){
Â  while(true){
Â  Â  const x = Math.floor(Math.random()*cols);
Â  Â  const y = Math.floor(Math.random()*rows);
Â  Â  if(!snake.some(s => s.x===x && s.y===y)){
Â  Â  Â  food = {x,y};
Â  Â  Â  return;
Â  Â  }
Â  }
}

function startGame(){
Â  if(running || dead) return;
Â  running = true;
Â  restartTicker();
}

function restartTicker(){
Â  clearInterval(tickTimer);
Â  tickTimer = setInterval(step, tickInterval);
}

function step(){
Â  if(nextDir.x !== -dir.x || nextDir.y !== -dir.y){
Â  Â  dir = nextDir;
Â  }

Â  const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };

Â  if(head.x<0 || head.x>=cols || head.y<0 || head.y>=rows){
Â  Â  gameOver(); return;
Â  }
Â  if(snake.some(s => s.x===head.x && s.y===head.y)){
Â  Â  gameOver(); return;
Â  }

Â  snake.unshift(head);

Â  if(head.x === food.x && head.y === food.y){
Â  Â  score++;
Â  Â  placeFood();

Â  Â  if(score % 3 === 0){
Â  Â  Â  tickInterval = Math.max(40, tickInterval * 0.9);
Â  Â  Â  restartTicker();
Â  Â  }
Â  } else {
Â  Â  snake.pop();
Â  }

Â  updateHud();
Â  draw();
}

function gameOver(){
Â  running = false;
Â  dead = true;
Â  clearInterval(tickTimer);

Â  const isNewBest = score > best;

Â  if(isNewBest){
Â  Â  best = score;
Â  Â  localStorage.setItem('snake_best', String(best));
Â  }
Â  updateHud();

Â  // Define colors
Â  const redColor = '#ff4444';
Â  const redGlow = '0 0 8px rgba(255, 68, 68, 0.5)';
Â Â 
Â  const goldColor = '#FFD700'; // Gold color for new record
Â  const goldGlow = '0 0 10px 5px rgba(255, 215, 0, 0.4)';
Â Â 
Â  let primaryColor, shadowGlow, canvasGlow;
Â Â 
Â  if (isNewBest) {
Â  Â  primaryColor = goldColor;
Â  Â  shadowGlow = '0 0 8px ' + primaryColor;
Â  Â  canvasGlow = goldGlow;
Â  } else {
Â  Â  primaryColor = redColor;
Â  Â  shadowGlow = redGlow;
Â  Â  canvasGlow = '0 0 0 4px rgba(255, 50, 50, 0.3)';
Â  }

Â  // Apply colors and glows
Â  canvas.style.boxShadow = canvasGlow;
Â Â 
Â  // Apply styling to BOTH titles
Â  desktopTitleEl.style.color = primaryColor;
Â  desktopTitleEl.style.textShadow = shadowGlow;
Â  mobileTitleEl.style.color = primaryColor;
Â  mobileTitleEl.style.textShadow = shadowGlow;
Â Â 
Â  // Score is always colored by the primary color (Red or Gold)
Â  scoreLabelEl.style.color = primaryColor;
Â  scoreEl.style.color = primaryColor;
Â Â 
Â  // Best is only colored by the primary color (Gold) if it's a new best, otherwise it retains green.
Â  if (isNewBest) {
Â  Â  bestLabelEl.style.color = primaryColor;
Â  Â  bestEl.style.color = primaryColor;
Â  }

Â  draw();
}

function updateHud(){
Â  scoreEl.textContent = score;
Â  bestEl.textContent = best;
Â  speedEl.textContent = Math.round(1000/tickInterval);
}

function draw(){
Â  ctx.clearRect(0,0,canvas.width,canvas.height);
Â  ctx.fillStyle = '#03151b';
Â  ctx.fillRect(0,0,canvas.width,canvas.height);

Â  // FOOD â†’ RED
Â  drawCell(food.x, food.y, '#ff4444');

Â  for(let i=snake.length-1;i>=0;i--){
Â  Â  const s = snake[i];
Â  Â  if(i===0) drawCell(s.x,s.y,'#8ef7b6', true, dir); // Pass 'dir' for head
Â  Â  else drawCell(s.x,s.y,'#1de38a');
Â  }

Â  // Draw grid lines, making the outer ones brighter and thicker
Â  for(let x=0;x<=cols;x++){
Â  Â  if(x === 0 || x === cols){
Â  Â  Â  ctx.strokeStyle = 'rgba(255,255,255,0.15)';
Â  Â  Â  ctx.lineWidth = 2;
Â  Â  } else {
Â  Â  Â  ctx.strokeStyle = 'rgba(255,255,255,0.02)';
Â  Â  Â  ctx.lineWidth = 1;
Â  Â  }
Â  Â  ctx.beginPath(); ctx.moveTo(x*gridSize,0); ctx.lineTo(x*gridSize,canvas.height); ctx.stroke();
Â  }
Â  for(let y=0;y<=rows;y++){
Â  Â  if(y === 0 || y === rows){
Â  Â  Â  ctx.strokeStyle = 'rgba(255,255,255,0.15)';
Â  Â  Â  ctx.lineWidth = 2;
Â  Â  } else {
Â  Â  Â  ctx.strokeStyle = 'rgba(255,255,255,0.02)';
Â  Â  Â  ctx.lineWidth = 1;
Â  Â  }
Â  Â  ctx.beginPath(); ctx.moveTo(0,y*gridSize); ctx.lineTo(canvas.width,y*gridSize); ctx.stroke();
Â  }
Â  ctx.lineWidth = 1; // Reset line width
}

function drawCell(cx, cy, color, isHead=false, currentDir = {x:1, y:0}){ // Added currentDir parameter
Â  const px = cx * gridSize;
Â  const py = cy * gridSize;
Â  const pad = 2;

Â  if(isHead){
Â  Â  const g = ctx.createLinearGradient(px,py,px+gridSize,py+gridSize);
Â  Â  g.addColorStop(0,color);
Â  Â  g.addColorStop(1,'#0fffc2');
Â  Â  ctx.fillStyle = g;
Â  } else ctx.fillStyle = color;

Â  roundRect(ctx, px+pad, py+pad, gridSize-2*pad, gridSize-2*pad, 6);
Â  ctx.fill();

Â  // Draw arrow on snake head
Â  if(isHead) {
Â  Â  ctx.fillStyle = '#ff4444'; // Arrow color (RED for contrast)
Â  Â  ctx.beginPath();

Â  Â  const arrowSize = gridSize * 0.25; // Smaller size of the arrow relative to the cell
Â  Â  const centerX = px + gridSize / 2;
Â  Â  const centerY = py + gridSize / 2;

Â  Â  if (currentDir.x === 1) { // Right
Â  Â  Â  Â  ctx.moveTo(centerX + arrowSize/2, centerY);
Â  Â  Â  Â  ctx.lineTo(centerX - arrowSize/2, centerY - arrowSize/2);
Â  Â  Â  Â  ctx.lineTo(centerX - arrowSize/2, centerY + arrowSize/2);
Â  Â  } else if (currentDir.x === -1) { // Left
Â  Â  Â  Â  ctx.moveTo(centerX - arrowSize/2, centerY);
Â  Â  Â  Â  ctx.lineTo(centerX + arrowSize/2, centerY - arrowSize/2);
Â  Â  Â  Â  ctx.lineTo(centerX + arrowSize/2, centerY + arrowSize/2);
Â  Â  } else if (currentDir.y === 1) { // Down
Â  Â  Â  Â  ctx.moveTo(centerX, centerY + arrowSize/2);
Â  Â  Â  Â  ctx.lineTo(centerX - arrowSize/2, centerY - arrowSize/2);
Â  Â  Â  Â  ctx.lineTo(centerX + arrowSize/2, centerY - arrowSize/2);
Â  Â  } else if (currentDir.y === -1) { // Up
Â  Â  Â  Â  ctx.moveTo(centerX, centerY - arrowSize/2);
Â  Â  Â  Â  ctx.lineTo(centerX - arrowSize/2, centerY + arrowSize/2);
Â  Â  Â  Â  ctx.lineTo(centerX + arrowSize/2, centerY + arrowSize/2);
Â  Â  }
Â  Â  ctx.closePath();
Â  Â  ctx.fill();
Â  }
}

function roundRect(ctx,x,y,w,h,r){
Â  ctx.beginPath();
Â  ctx.moveTo(x+r,y);
Â  ctx.arcTo(x+w,y, x+w,y+h, r);
Â  ctx.arcTo(x+w,y+h, x,y+h, r);
Â  ctx.arcTo(x,y+h, x,y, r);
Â  ctx.arcTo(x,y, x+w,y, r);
Â  ctx.closePath();
}

// KEYBOARD INPUT + AUTO-START AFTER DEATH
window.addEventListener('keydown', e => {
Â  const k = e.key;

Â  let newDir = null;

Â  if(k==='ArrowUp'||k==='w'||k==='W'){ newDir={x:0,y:-1}; }
Â  if(k==='ArrowDown'||k==='s'||k==='S'){ newDir={x:0,y:1}; }
Â  if(k==='ArrowLeft'||k==='a'||k==='A'){ newDir={x:-1,y:0}; }
Â  if(k==='ArrowRight'||k==='d'||k==='D'){ newDir={x:1,y:0}; }

Â  if(newDir){
Â  Â  // 1. Prevent the default action (like scrolling) for movement keys
Â  Â  e.preventDefault();Â 
Â  Â Â 
Â  Â  // 2. Simulate the button press animation
Â  Â  simulateKeyPress(k);
Â  Â Â 
Â  Â  // 3. Set the direction and potentially start the game
Â  Â  setDirection(newDir);
Â  }

Â  if(k===' '){
Â  Â  // Prevent the default action (like scrolling) for the Spacebar
Â  Â  e.preventDefault();Â 
Â  Â  if(dead){
Â  Â  Â  resetGame();
Â  Â  } else if(!running){
Â  Â  Â  startGame();
Â  Â  }
Â  }
});

// DESKTOP button listeners
startBtn.addEventListener('click', startGame);
resetBtn.addEventListener('click', resetGame);
resetAllDesktopBtn.addEventListener('click', showResetAllConfirmation);Â 

// MOBILE button listeners
startMobileBtn.addEventListener('click', startGame);
resetMobileBtn.addEventListener('click', resetGame);
resetAllMobileBtn.addEventListener('click', showResetAllConfirmation);Â 

// --- Event Listeners for Custom Modal ---
confirmYesBtn.addEventListener('click', executeResetAll);
confirmNoBtn.addEventListener('click', () => {
Â  Â  confirmModal.style.display = 'none';
});

// --- Dynamic Element Reordering for Mobile View ---
(function dynamicLayoutAdjustment() {
Â  Â  const isMobile = window.innerWidth <= 720;Â 
Â  Â  const desktopButtonsContainer = document.getElementById('desktop-buttons');
Â  Â  const mobileButtonsRow = document.getElementById('mobile-buttons-row');
Â  Â  const mobileResetAllContainer = document.getElementById('mobile-reset-all-container');
Â  Â  const hud = document.querySelector('.hud'); // The score/best/speed section


Â  Â  if (isMobile) {
Â  Â  Â  Â  const card = document.querySelector('.card');
Â  Â  Â  Â  const playwrap = document.querySelector('.playwrap');
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Final order on mobile:
Â  Â  Â  Â  // 1. Playwrap (Title, Canvas, Controls)
Â  Â  Â  Â  // 2. Mobile Buttons Row (Start/Reset)
Â  Â  Â  Â  // 3. HUD (Score/Best/Speed + Reset All)

Â  Â  Â  Â  if (card && playwrap && hud && mobileButtonsRow) {
Â  Â  Â  Â  Â  Â  // Re-order the children of the card container
Â  Â  Â  Â  Â  Â  card.appendChild(playwrap);Â 
Â  Â  Â  Â  Â  Â  card.appendChild(mobileButtonsRow);Â 
Â  Â  Â  Â  Â  Â  card.appendChild(hud);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Hide desktop-only elements
Â  Â  Â  Â  if (desktopButtonsContainer) {
Â  Â  Â  Â  Â  Â  Â desktopButtonsContainer.style.display = 'none';
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const hudFooter = document.querySelector('.hud-footer');
Â  Â  Â  Â  if (hudFooter) {
Â  Â  Â  Â  Â  Â  hudFooter.style.display = 'none';
Â  Â  Â  Â  }

Â  Â  } else {
Â  Â  Â  Â  // Hide mobile-only containers on desktop
Â  Â  Â  Â  if (mobileButtonsRow) {
Â  Â  Â  Â  Â  Â  mobileButtonsRow.style.display = 'none';
Â  Â  Â  Â  }
Â  Â  Â  Â  if (mobileResetAllContainer) {
Â  Â  Â  Â  Â  Â  mobileResetAllContainer.style.display = 'none';
Â  Â  Â  Â  }
Â  Â  }
})();


resetGame();
</script>
</body>
</html>
