<!doctype html>
<html lang="en">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>Snake â€” Classic HTML Game</title>
Â  <style>
Â  Â  :root{--bg:#0f1724;--card:#0b1220;--accent:#22c55e;--muted:#94a3b8}
Â  Â  *{box-sizing:border-box}
Â  Â  /* Set body overflow to hidden and adjusted wrap padding */
Â  Â  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--bg),#071021);color:#e6eef8; overflow: hidden;}
Â  Â  .wrap{
Â  Â  Â  Â  min-height:100vh;
Â  Â  Â  Â  display:flex;
Â  Â  Â  Â  /* Default: Center content vertically on desktop */
Â  Â  Â  Â  align-items:center;
Â  Â  Â  Â  justify-content:center;
Â  Â  Â  Â  padding:12px;Â 
Â  Â  }
Â  Â  .card{
Â  Â  Â  Â  background:rgba(255,255,255,0.03);
Â  Â  Â  Â  padding:18px;Â 
Â  Â  Â  Â  border-radius:12px;
Â  Â  Â  Â  box-shadow:0 6px 24px rgba(2,6,23,0.6);
Â  Â  Â  Â  display:flex;
Â  Â  Â  Â  gap: 30px;Â 
Â  Â  Â  Â  align-items: flex-start;Â 
Â  Â  Â  Â  justify-content: center;Â 
Â  Â  }
Â  Â  canvas{
Â  Â  Â  Â  background:linear-gradient(180deg,#071422,#08202b);
Â  Â  Â  Â  border-radius:8px;
Â  Â  Â  Â  display:block;
Â  Â  Â  Â  transition: box-shadow 0.2s ease-out;Â 
Â  Â  }
Â  Â  .hud{
Â  Â  Â  Â  display:flex;
Â  Â  Â  Â  flex-direction:column;
Â  Â  Â  Â  gap:10px;
Â  Â  Â  Â  min-width:180px;
Â  Â  Â  Â  /* Manually push the HUD down to visually align its center with the 480px canvas center */
Â  Â  Â  Â  margin-top: 65px;Â 
Â  Â  }
Â  Â  .hud .row{display:flex;justify-content:space-between;align-items:center}
Â  Â  .btn{background:transparent;border:1px solid rgba(255,255,255,0.07);padding:8px 10px;border-radius:8px;color:var(--muted);cursor:pointer; transition: background 0.1s}
Â  Â  .btn.primary{border-color:var(--accent);color:var(--accent)}
Â  Â  .btn.danger{border-color:#ef4444;color:#ef4444}Â 
Â  Â  .btn.danger:hover{background: rgba(239, 68, 68, 0.1);}
Â  Â  .btn.success{border-color:var(--accent);color:#fff;background:var(--accent)}Â 
Â  Â  .hint{font-size:13px;color:var(--muted)}
Â  Â  .big{font-size:20px;font-weight:600}

Â  Â  .big, #score, #best {
Â  Â  Â  Â  transition: color 0.2s ease-out;
Â  Â  }
Â  Â Â 
Â  Â  .red-warning {
Â  Â  Â  Â  color: #ff4444;
Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  text-transform: uppercase;
Â  Â  }
Â  Â  .green-control {
Â  Â  Â  Â  color: var(--accent);
Â  Â  Â  Â  font-weight: 600;
Â  Â  }
Â  Â Â 
Â  Â  /* MOBILE STYLES START */
Â  Â  @media(max-width:720px){
Â  Â  Â  Â  .wrap{
Â  Â  Â  Â  Â  Â  /* ELIMINATE SPACE: Remove all outer padding */
Â  Â  Â  Â  Â  Â  padding: 0;Â 
Â  Â  Â  Â  Â  Â  /* ELIMINATE SPACE: Align content to the top instead of centering */
Â  Â  Â  Â  Â  Â  align-items: flex-start;
Â  Â  Â  Â  }
Â  Â  Â  Â  .card{
Â  Â  Â  Â  Â  Â  flex-direction:column;
Â  Â  Â  Â  Â  Â  /* ELIMINATE SPACE: Reduce card padding (just enough for visual margin) */
Â  Â  Â  Â  Â  Â  padding: 8px;Â 
Â  Â  Â  Â  Â  Â  gap: 12px;
Â  Â  Â  Â  Â  Â  align-items: center;Â 
Â  Â  Â  Â  Â  Â  /* Ensure card takes full width for responsive layout */
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  /* ELIMINATE SPACE: Remove box shadow so it doesn't create extra scroll space */
Â  Â  Â  Â  Â  Â  box-shadow: none;Â 
Â  Â  Â  Â  Â  Â  background: transparent; /* Card background is unnecessary when using full width */
Â  Â  Â  Â  }
Â  Â  Â  Â  .hud{
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  max-width: 480px;Â 
Â  Â  Â  Â  Â  Â  /* ðŸ”¥ FINAL FIX: Ensure HUD itself has no top/bottom margin */
Â  Â  Â  Â  Â  Â  margin: 0 auto;Â 
Â  Â  Â  Â  Â  Â  /* Tighter gap between score rows */
Â  Â  Â  Â  Â  Â  gap: 5px;Â 
Â  Â  Â  Â  Â  Â  /* ðŸ”¥ FINAL FIX: Set padding to 0, 0, 10px, 0. This is the main score container. */
Â  Â  Â  Â  Â  Â  padding: 0 0 10px 0;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .hud .row{
Â  Â  Â  Â  Â  Â  font-size: 16px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .hud .row .big {
Â  Â  Â  Â  Â  Â  font-size: 16px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Constrain the width of the score rows and the button container */
Â  Â  Â  Â  .hud .row, .hud-footer, #mobile-reset-all-container {
Â  Â  Â  Â  Â  Â  max-width: 300px;Â 
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  margin-left: auto;
Â  Â  Â  Â  Â  Â  margin-right: auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  .hud-footer {
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  margin-top: 5px;Â 
Â  Â  Â  Â  Â  Â  padding-top: 5px;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Make canvas fluid on small screens */
Â  Â  Â  Â  canvas {
Â  Â  Â  Â  Â  Â  width: 90vw;Â 
Â  Â  Â  Â  Â  Â  height: 90vw;Â 
Â  Â  Â  Â  Â  Â  max-width: 480px;Â 
Â  Â  Â  Â  Â  Â  max-height: 480px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .playwrap {
Â  Â  Â  Â  Â  Â  margin-top: 0;Â 
Â  Â  Â  Â  Â  Â  /* Remove bottom padding from playwrap to pull the score section up */
Â  Â  Â  Â  Â  Â  padding-bottom: 0;Â 
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  }
Â  Â  Â  Â  .controls {
Â  Â  Â  Â  Â  Â  /* Keep margin top for separation from canvas, but remove margin bottom */
Â  Â  Â  Â  Â  Â  margin: 15px auto 0;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Hide the Desktop Title and Hints in the HUD on mobile */
Â  Â  Â  Â  .hud > .desktop-title, .hud > .hint {Â 
Â  Â  Â  Â  Â  Â  Â display: none !important;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Show the mobile title above the canvas */
Â  Â  Â  Â  .playwrap .mobile-title {
Â  Â  Â  Â  Â  Â  display: block !important;
Â  Â  Â  Â  Â  Â  margin-bottom: 8px; /* Slightly reduced margin */
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Mobile Buttons Row (Start/Reset) - Only visible when game is not running */
Â  Â  Â  Â  #mobile-buttons-row {
Â  Â  Â  Â  Â  Â  display: flex; /* ðŸ”¥ FIX 1: Ensure Start/Reset buttons are visible on mobile */
Â  Â  Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  Â  Â  max-width: 300px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  /* Removed all margin/padding around this row, relying on margin from controls only */
Â  Â  Â  Â  Â  Â  margin: 0 auto 0 auto;Â 
Â  Â  Â  Â  Â  Â  padding: 10px 0 0 0;
Â  Â  Â  Â  Â  Â  border-top: 1px solid rgba(255, 255, 255, 0.05);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Mobile Button for Reset All is placed immediately after the speed row */
Â  Â  Â  Â  #mobile-reset-all-container {
Â  Â  Â  Â  Â  Â  display: flex; /* ðŸ”¥ FIX 2: Ensure Reset All button is visible on mobile */
Â  Â  Â  Â  Â  Â  /* Top margin to slightly separate it from the Speed row (which is the element right before it) */
Â  Â  Â  Â  Â  Â  margin: 10px auto 0 auto;Â 
Â  Â  Â  Â  Â  Â  padding-top: 5px;Â 
Â  Â  Â  Â  Â  Â  border-top: 1px solid rgba(255, 255, 255, 0.05);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Make all buttons in the row equal width */
Â  Â  Â  Â  #mobile-buttons-row .btn, #mobile-reset-all-container .btn {
Â  Â  Â  Â  Â  Â  flex-grow: 1;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Hide the desktop-only reset-all container on mobile */
Â  Â  Â  Â  .hud-footer {
Â  Â  Â  Â  Â  Â  display: none !important; /* Force hide desktop element */
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Hide the desktop buttons row entirely on mobile */
Â  Â  Â  Â  #desktop-buttons {
Â  Â  Â  Â  Â  Â  display: none !important;
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  /* Hide mobile-specific containers on desktop */
Â  Â  #mobile-buttons-row, #mobile-reset-all-container, .playwrap .mobile-title {
Â  Â  Â  Â  display: none;
Â  Â  }
Â  Â Â 
Â  Â  .playwrap{display:flex;flex-direction:column;align-items:center;gap:8px}
Â  Â  .title{
Â  Â  Â  Â  font-size:28px;
Â  Â  Â  Â  font-weight:700;
Â  Â  Â  Â  color: #e6eef8;Â 
Â  Â  Â  Â  text-shadow: 0 0 8px rgba(230, 238, 248, 0.3);Â 
Â  Â  Â  Â  margin-bottom:4px;
Â  Â  Â  Â  text-align:center;
Â  Â  Â  Â  transition: color 0.2s ease-out, text-shadow 0.2s ease-out;Â 
Â  Â  }
Â  Â Â 
Â  Â  .hud-footer{
Â  Â  Â  Â  display:flex;
Â  Â  Â  Â  flex-direction:column;
Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  padding-top: 10px;
Â  Â  Â  Â  border-top: 1px solid rgba(255, 255, 255, 0.05);
Â  Â  }

Â  Â  /* CUSTOM MODAL STYLES START */
Â  Â  #confirm-modal {
Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  background: rgba(0, 0, 0, 0.8);
Â  Â  Â  Â  display: none;Â 
Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  z-index: 1000;
Â  Â  Â  Â  backdrop-filter: blur(4px);
Â  Â  }
Â  Â  .modal-content {
Â  Â  Â  Â  background: var(--card);
Â  Â  Â  Â  padding: 25px;
Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
Â  Â  Â  Â  max-width: 350px;
Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  gap: 20px;
Â  Â  }
Â  Â  .modal-content p {
Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  line-height: 1.4;
Â  Â  }
Â  Â  .modal-buttons {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  justify-content: space-around;
Â  Â  Â  Â  gap: 10px;
Â  Â  }
Â  Â  .modal-buttons .btn {
Â  Â  Â  Â  flex-grow: 1;
Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  font-size: 16px;
Â  Â  }
Â  Â  /* CUSTOM MODAL STYLES END */
Â  Â Â 
Â  Â  /* MOBILE CONTROLS STYLES */
Â  Â  .controls {
Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  grid-template-areas: ". up ." "left center right" ". down .";
Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  width: 150px;Â 
Â  Â  Â  Â  margin: 20px auto 0;
Â  Â  }
Â  Â  .control-btn {
Â  Â  Â  Â  grid-area: var(--area);
Â  Â  Â  Â  width: 50px;
Â  Â  Â  Â  height: 50px;
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  font-size: 20px;
Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  background: rgba(255, 255, 255, 0.05);
Â  Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  Â  Â  color: var(--accent);
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  transition: background 0.1s, transform 0.05s;
Â  Â  Â  Â  -webkit-tap-highlight-color: transparent;Â 
Â  Â  }
Â  Â  .control-btn:active,
Â  Â  .control-btn.key-press-simulated {Â 
Â  Â  Â  Â  background: rgba(34, 197, 94, 0.2);
Â  Â  Â  Â  transform: scale(0.95);
Â  Â  }

Â  Â  /* Assign grid areas */
Â  Â  #up-btn { --area: up; }
Â  Â  #down-btn { --area: down; }
Â  Â  #left-btn { --area: left; }
Â  Â  #right-btn { --area: right; }
Â  Â Â 
Â  </style>
</head>
<body>
Â  <div class="wrap">
Â  Â  <div class="card">
Â  Â  Â  <div class="playwrap">
Â  Â  Â  Â  <div class="title mobile-title">Byte Serpent</div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <canvas id="game" width="480" height="480"></canvas>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="controls">
Â  Â  Â  Â  Â  Â  <button id="up-btn" class="control-btn" data-dir="up">â–²</button>
Â  Â  Â  Â  Â  Â  <div id="center-spacer" style="grid-area: center; visibility: hidden;"></div>
Â  Â  Â  Â  Â  Â  <button id="left-btn" class="control-btn" data-dir="left">â—€</button>
Â  Â  Â  Â  Â  Â  <button id="right-btn" class="control-btn" data-dir="right">â–¶</button>
Â  Â  Â  Â  Â  Â  <button id="down-btn" class="control-btn" data-dir="down">â–¼</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="mobile-buttons-row">
Â  Â  Â  Â  Â  <button id="start-mobile" class="btn primary">Start</button>
Â  Â  Â  Â  Â  <button id="reset-mobile" class="btn">Reset</button>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div class="hud">
Â  Â  Â  Â  <div class="title desktop-title">Byte Serpent</div>
Â  Â  Â  Â  <div class="row"><div class="big">Score</div><div id="score">0</div></div>
Â  Â  Â  Â  <div class="row"><div class="big">Best</div><div id="best">0</div></div>
Â  Â  Â  Â  <div class="row"><div class="hint">Speed</div><div id="speed">6</div></div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div id="mobile-reset-all-container">
Â  Â  Â  Â  Â  Â  <button id="reset-all-mobile" class="btn danger">Reset All</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="desktop-buttons" style="display:flex;gap:8px">
Â  Â  Â  Â  Â  <button id="start" class="btn primary">Start</button>
Â  Â  Â  Â  Â  <button id="reset" class="btn">Reset</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="hint">Controls: <span class="green-control">Arrow keys</span> / <span class="green-control">WASD</span></div>
Â  Â  Â  Â  <div class="hint">Try to eat the <span class="red-warning">RED FOOD</span>. Don't hit the <span class="red-warning">WALLS</span> or <span class="red-warning">YOURSELF</span>.</div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="hud-footer">
Â  Â  Â  Â  Â  Â  <button id="reset-all-desktop" class="btn danger">Reset All</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
Â Â 
Â  <div id="confirm-modal">
Â  Â  <div class="modal-content">
Â  Â  Â  Â  <p>Are you sure you want to wipe your Best Score?</p>
Â  Â  Â  Â  <p class="hint" style="color: #ef4444; font-weight: 600;">THIS ACTION CANNOT BE UNDONE.</p>
Â  Â  Â  Â  <div class="modal-buttons">
Â  Â  Â  Â  Â  Â  <button id="confirm-no" class="btn">No</button>
Â  Â  Â  Â  Â  Â  <button id="confirm-yes" class="btn success">Yes, Reset All</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
Â  <script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const scoreEl = document.getElementById('score');
const bestEl = document.getElementById('best');
const speedEl = document.getElementById('speed');

// Desktop Buttons
const startBtn = document.getElementById('start');
const resetBtn = document.getElementById('reset');

// Mobile Buttons (New IDs)
const startMobileBtn = document.getElementById('start-mobile');
const resetMobileBtn = document.getElementById('reset-mobile');

// Reset All Buttons
const resetAllDesktopBtn = document.getElementById('reset-all-desktop');
const resetAllMobileBtn = document.getElementById('reset-all-mobile');


// Title Elements
const desktopTitleEl = document.querySelector('.desktop-title');Â 
const mobileTitleEl = document.querySelector('.mobile-title');Â 


// Custom Modal elements
const confirmModal = document.getElementById('confirm-modal');
const confirmYesBtn = document.getElementById('confirm-yes');
const confirmNoBtn = document.getElementById('confirm-no');

// Get score/best labels
const scoreLabelEl = scoreEl.parentElement.querySelector('.big');
const bestLabelEl = bestEl.parentElement.querySelector('.big');

// New Control elements
const controlBtns = document.querySelectorAll('.control-btn');
// Map keyboard keys to control button IDs
const keyMap = {
Â  Â  'ArrowUp': 'up-btn', 'w': 'up-btn', 'W': 'up-btn',
Â  Â  'ArrowDown': 'down-btn', 's': 'down-btn', 'S': 'down-btn',
Â  Â  'ArrowLeft': 'left-btn', 'a': 'left-btn', 'A': 'left-btn',
Â  Â  'ArrowRight': 'right-btn', 'd': 'right-btn', 'D': 'right-btn'
};

const gridSize = 20;
const cols = canvas.width / gridSize;
const rows = canvas.height / gridSize;

let snake;
let dir;
let nextDir;
let food;

let tickInterval;
let tickTimer = null;

let running = false;
let dead = false;

let score = 0;
let best = Number(localStorage.getItem('snake_best') || 0);
bestEl.textContent = best;

// Function to handle direction setting (used by both keyboard and buttons)
function setDirection(newDir) {
Â  nextDir = newDir;
Â  if (dead) {
Â  Â  resetGame();
Â  Â  startGame();
Â  } else if (!running) {
Â  Â  startGame();
Â  }
}

// Function to simulate the click animation
function simulateKeyPress(key) {
Â  Â  const btnId = keyMap[key];
Â  Â  if (btnId) {
Â  Â  Â  Â  const btn = document.getElementById(btnId);
Â  Â  Â  Â  if (btn) {
Â  Â  Â  Â  Â  Â  btn.classList.add('key-press-simulated');
Â  Â  Â  Â  Â  Â  // Remove the class after a short delay (e.g., 100ms)
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.remove('key-press-simulated');
Â  Â  Â  Â  Â  Â  }, 100);
Â  Â  Â  Â  }
Â  Â  }
}

// --- Event Listeners for Custom Controls (On-Screen Buttons) ---
controlBtns.forEach(btn => {
Â  Â  btn.addEventListener('click', (e) => {
Â  Â  Â  Â  const direction = e.currentTarget.getAttribute('data-dir');
Â  Â  Â  Â  let newDir = null;
Â  Â  Â  Â Â 
Â  Â  Â  Â  switch (direction) {
Â  Â  Â  Â  Â  Â  case 'up': newDir = { x: 0, y: -1 }; break;
Â  Â  Â  Â  Â  Â  case 'down': newDir = { x: 0, y: 1 }; break;
Â  Â  Â  Â  Â  Â  case 'left': newDir = { x: -1, y: 0 }; break;
Â  Â  Â  Â  Â  Â  case 'right': newDir = { x: 1, y: 0 }; break;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (newDir) {
Â  Â  Â  Â  Â  Â  setDirection(newDir);
Â  Â  Â  Â  }
Â  Â  });
});


// Function to reset all data (including high score) - Triggered by modal 'Yes'
function executeResetAll() {
Â  Â  // 1. Clear best score from local storage
Â  Â  localStorage.removeItem('snake_best');
Â  Â Â 
Â  Â  // 2. Reset the best variable
Â  Â  best = 0;
Â  Â Â 
Â  Â  // 3. Reset the current game
Â  Â  resetGame();

Â  Â  // 4. Hide the modal
Â  Â  confirmModal.style.display = 'none';
}

// Function to show the custom confirmation modal - Triggered by 'Reset All' button
function showResetAllConfirmation() {
Â  Â  confirmModal.style.display = 'flex';
}

// RESET GAME
function resetGame(){
Â  snake = [{ x: Math.floor(cols/2), y: Math.floor(rows/2) }];
Â  dir = {x:1, y:0};
Â  nextDir = {x:1, y:0};

Â  placeFood();
Â  score = 0;
Â  tickInterval = 1000 / 6;

Â  running = false;
Â  dead = false;

Â  clearInterval(tickTimer);
Â  updateHud();
Â Â 
Â  // Reset styles on game reset
Â  desktopTitleEl.style.color = '';
Â  desktopTitleEl.style.textShadow = '';
Â  mobileTitleEl.style.color = '';Â 
Â  mobileTitleEl.style.textShadow = '';Â 
Â  canvas.style.boxShadow = '';
Â Â 
Â  // Set ALL elements to "alive" green color (var(--accent) is #22c55e)
Â  scoreLabelEl.style.color = 'var(--accent)';
Â  scoreEl.style.color = 'var(--accent)';
Â  bestLabelEl.style.color = 'var(--accent)';
Â  bestEl.style.color = 'var(--accent)';
Â Â 
Â  draw();
}

function placeFood(){
Â  while(true){
Â  Â  const x = Math.floor(Math.random()*cols);
Â  Â  const y = Math.floor(Math.random()*rows);
Â  Â  if(!snake.some(s => s.x===x && s.y===y)){
Â  Â  Â  food = {x,y};
Â  Â  Â  return;
Â  Â  }
Â  }
}

function startGame(){
Â  if(running || dead) return;
Â  running = true;
Â  restartTicker();
}

function restartTicker(){
Â  clearInterval(tickTimer);
Â  tickTimer = setInterval(step, tickInterval);
}

function step(){
Â  if(nextDir.x !== -dir.x || nextDir.y !== -dir.y){
Â  Â  dir = nextDir;
Â  }

Â  const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };

Â  if(head.x<0 || head.x>=cols || head.y<0 || head.y>=rows){
Â  Â  gameOver(); return;
Â  }
Â  if(snake.some(s => s.x===head.x && s.y===head.y)){
Â  Â  gameOver(); return;
Â  }

Â  snake.unshift(head);

Â  if(head.x === food.x && head.y === food.y){
Â  Â  score++;
Â  Â  placeFood();

Â  Â  if(score % 3 === 0){
Â  Â  Â  tickInterval = Math.max(40, tickInterval * 0.9);
Â  Â  Â  restartTicker();
Â  Â  }
Â  } else {
Â  Â  snake.pop();
Â  }

Â  updateHud();
Â  draw();
}

function gameOver(){
Â  running = false;
Â  dead = true;
Â  clearInterval(tickTimer);

Â  const isNewBest = score > best;

Â  if(isNewBest){
Â  Â  best = score;
Â  Â  localStorage.setItem('snake_best', String(best));
Â  }
Â  updateHud();

Â  // Define colors
Â  const redColor = '#ff4444';
Â  const redGlow = '0 0 8px rgba(255, 68, 68, 0.5)';
Â Â 
Â  const goldColor = '#FFD700'; // Gold color for new record
Â  const goldGlow = '0 0 10px 5px rgba(255, 215, 0, 0.4)';
Â Â 
Â  let primaryColor, shadowGlow, canvasGlow;
Â Â 
Â  if (isNewBest) {
Â  Â  primaryColor = goldColor;
Â  Â  shadowGlow = '0 0 8px ' + primaryColor;
Â  Â  canvasGlow = goldGlow;
Â  } else {
Â  Â  primaryColor = redColor;
Â  Â  shadowGlow = redGlow;
Â  Â  canvasGlow = '0 0 0 4px rgba(255, 50, 50, 0.3)';
Â  }

Â  // Apply colors and glows
Â  canvas.style.boxShadow = canvasGlow;
Â Â 
Â  // Apply styling to BOTH titles
Â  desktopTitleEl.style.color = primaryColor;
Â  desktopTitleEl.style.textShadow = shadowGlow;
Â  mobileTitleEl.style.color = primaryColor;
Â  mobileTitleEl.style.textShadow = shadowGlow;
Â Â 
Â  // Score is always colored by the primary color (Red or Gold)
Â  scoreLabelEl.style.color = primaryColor;
Â  scoreEl.style.color = primaryColor;
Â Â 
Â  // Best is only colored by the primary color (Gold) if it's a new best, otherwise it retains green.
Â  if (isNewBest) {
Â  Â  bestLabelEl.style.color = primaryColor;
Â  Â  bestEl.style.color = primaryColor;
Â  }

Â  draw();
}

function updateHud(){
Â  scoreEl.textContent = score;
Â  bestEl.textContent = best;
Â  speedEl.textContent = Math.round(1000/tickInterval);
}

function draw(){
Â  ctx.clearRect(0,0,canvas.width,canvas.height);
Â  ctx.fillStyle = '#03151b';
Â  ctx.fillRect(0,0,canvas.width,canvas.height);

Â  // FOOD â†’ RED
Â  drawCell(food.x, food.y, '#ff4444');

Â  for(let i=snake.length-1;i>=0;i--){
Â  Â  const s = snake[i];
Â  Â  if(i===0) drawCell(s.x,s.y,'#8ef7b6', true, dir); // Pass 'dir' for head
Â  Â  else drawCell(s.x,s.y,'#1de38a');
Â  }

Â  // Draw grid lines, making the outer ones brighter and thicker
Â  for(let x=0;x<=cols;x++){
Â  Â  if(x === 0 || x === cols){
Â  Â  Â  ctx.strokeStyle = 'rgba(255,255,255,0.15)';
Â  Â  Â  ctx.lineWidth = 2;
Â  Â  } else {
Â  Â  Â  ctx.strokeStyle = 'rgba(255,255,255,0.02)';
Â  Â  Â  ctx.lineWidth = 1;
Â  Â  }
Â  Â  ctx.beginPath(); ctx.moveTo(x*gridSize,0); ctx.lineTo(x*gridSize,canvas.height); ctx.stroke();
Â  }
Â  for(let y=0;y<=rows;y++){
Â  Â  if(y === 0 || y === rows){
Â  Â  Â  ctx.strokeStyle = 'rgba(255,255,255,0.15)';
Â  Â  Â  ctx.lineWidth = 2;
Â  Â  } else {
Â  Â  Â  ctx.strokeStyle = 'rgba(255,255,255,0.02)';
Â  Â  Â  ctx.lineWidth = 1;
Â  Â  }
Â  Â  ctx.beginPath(); ctx.moveTo(0,y*gridSize); ctx.lineTo(canvas.width,y*gridSize); ctx.stroke();
Â  }
Â  ctx.lineWidth = 1; // Reset line width
}

function drawCell(cx, cy, color, isHead=false, currentDir = {x:1, y:0}){ // Added currentDir parameter
Â  const px = cx * gridSize;
Â  const py = cy * gridSize;
Â  const pad = 2;

Â  if(isHead){
Â  Â  const g = ctx.createLinearGradient(px,py,px+gridSize,py+gridSize);
Â  Â  g.addColorStop(0,color);
Â  Â  g.addColorStop(1,'#0fffc2');
Â  Â  ctx.fillStyle = g;
Â  } else ctx.fillStyle = color;

Â  roundRect(ctx, px+pad, py+pad, gridSize-2*pad, gridSize-2*pad, 6);
Â  ctx.fill();

Â  // Draw arrow on snake head
Â  if(isHead) {
Â  Â  ctx.fillStyle = '#ff4444'; // Arrow color (RED for contrast)
Â  Â  ctx.beginPath();

Â  Â  const arrowSize = gridSize * 0.25; // Smaller size of the arrow relative to the cell
Â  Â  const centerX = px + gridSize / 2;
Â  Â  const centerY = py + gridSize / 2;

Â  Â  if (currentDir.x === 1) { // Right
Â  Â  Â  Â  ctx.moveTo(centerX + arrowSize/2, centerY);
Â  Â  Â  Â  ctx.lineTo(centerX - arrowSize/2, centerY - arrowSize/2);
Â  Â  Â  Â  ctx.lineTo(centerX - arrowSize/2, centerY + arrowSize/2);
Â  Â  } else if (currentDir.x === -1) { // Left
Â  Â  Â  Â  ctx.moveTo(centerX - arrowSize/2, centerY);
Â  Â  Â  Â  ctx.lineTo(centerX + arrowSize/2, centerY - arrowSize/2);
Â  Â  Â  Â  ctx.lineTo(centerX + arrowSize/2, centerY + arrowSize/2);
Â  Â  } else if (currentDir.y === 1) { // Down
Â  Â  Â  Â  ctx.moveTo(centerX, centerY + arrowSize/2);
Â  Â  Â  Â  ctx.lineTo(centerX - arrowSize/2, centerY - arrowSize/2);
Â  Â  Â  Â  ctx.lineTo(centerX + arrowSize/2, centerY - arrowSize/2);
Â  Â  } else if (currentDir.y === -1) { // Up
Â  Â  Â  Â  ctx.moveTo(centerX, centerY - arrowSize/2);
Â  Â  Â  Â  ctx.lineTo(centerX - arrowSize/2, centerY + arrowSize/2);
Â  Â  Â  Â  ctx.lineTo(centerX + arrowSize/2, centerY + arrowSize/2);
Â  Â  }
Â  Â  ctx.closePath();
Â  Â  ctx.fill();
Â  }
}

function roundRect(ctx,x,y,w,h,r){
Â  ctx.beginPath();
Â  ctx.moveTo(x+r,y);
Â  ctx.arcTo(x+w,y, x+w,y+h, r);
Â  ctx.arcTo(x+w,y+h, x,y+h, r);
Â  ctx.arcTo(x,y+h, x,y, r);
Â  ctx.arcTo(x,y, x+w,y, r);
Â  ctx.closePath();
}

// KEYBOARD INPUT + AUTO-START AFTER DEATH
window.addEventListener('keydown', e => {
Â  const k = e.key;

Â  let newDir = null;

Â  if(k==='ArrowUp'||k==='w'||k==='W'){ newDir={x:0,y:-1}; }
Â  if(k==='ArrowDown'||k==='s'||k==='S'){ newDir={x:0,y:1}; }
Â  if(k==='ArrowLeft'||k==='a'||k==='A'){ newDir={x:-1,y:0}; }
Â  if(k==='ArrowRight'||k==='d'||k==='D'){ newDir={x:1,y:0}; }

Â  if(newDir){
Â  Â  // 1. Prevent the default action (like scrolling) for movement keys
Â  Â  e.preventDefault();Â 
Â  Â Â 
Â  Â  // 2. Simulate the button press animation
Â  Â  simulateKeyPress(k);
Â  Â Â 
Â  Â  // 3. Set the direction and potentially start the game
Â  Â  setDirection(newDir);
Â  }

Â  if(k===' '){
Â  Â  // Prevent the default action (like scrolling) for the Spacebar
Â  Â  e.preventDefault();Â 
Â  Â  if(dead){
Â  Â  Â  resetGame();
Â  Â  } else if(!running){
Â  Â  Â  startGame();
Â  Â  }
Â  }
});

// DESKTOP button listeners
startBtn.addEventListener('click', startGame);
resetBtn.addEventListener('click', resetGame);
resetAllDesktopBtn.addEventListener('click', showResetAllConfirmation);Â 

// MOBILE button listeners
startMobileBtn.addEventListener('click', startGame);
resetMobileBtn.addEventListener('click', resetGame);
resetAllMobileBtn.addEventListener('click', showResetAllConfirmation);Â 

// --- Event Listeners for Custom Modal ---
confirmYesBtn.addEventListener('click', executeResetAll);
confirmNoBtn.addEventListener('click', () => {
Â  Â  confirmModal.style.display = 'none';
});

// --- Dynamic Element Reordering for Mobile View ---
(function dynamicLayoutAdjustment() {
Â  Â  const isMobile = window.innerWidth <= 720;Â 
Â  Â  const desktopButtonsContainer = document.getElementById('desktop-buttons');
Â  Â  const mobileButtonsRow = document.getElementById('mobile-buttons-row');
Â  Â  const mobileResetAllContainer = document.getElementById('mobile-reset-all-container');
Â  Â  const hud = document.querySelector('.hud'); // The score/best/speed section


Â  Â  if (isMobile) {
Â  Â  Â  Â  const card = document.querySelector('.card');
Â  Â  Â  Â  const playwrap = document.querySelector('.playwrap');
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ðŸ”¥ FIX 3: Correct Mobile Order
Â  Â  Â  Â  // 1. Playwrap (Title, Canvas, Controls)
Â  Â  Â  Â  // 2. Mobile Buttons Row (Start/Reset)
Â  Â  Â  Â  // 3. HUD (Score/Best/Speed + Reset All)

Â  Â  Â  Â  if (card && playwrap && hud && mobileButtonsRow) {
Â  Â  Â  Â  Â  Â  // Re-order the children of the card container to match mobile screenshot expectation
Â  Â  Â  Â  Â  Â  card.appendChild(playwrap);Â 
Â  Â  Â  Â  Â  Â  card.appendChild(mobileButtonsRow);Â 
Â  Â  Â  Â  Â  Â  card.appendChild(hud);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Hide desktop-only elements (Redundant with CSS but safe)
Â  Â  Â  Â  if (desktopButtonsContainer) {
Â  Â  Â  Â  Â  Â  Â desktopButtonsContainer.style.display = 'none';
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const hudFooter = document.querySelector('.hud-footer');
Â  Â  Â  Â  if (hudFooter) {
Â  Â  Â  Â  Â  Â  hudFooter.style.display = 'none';
Â  Â  Â  Â  }

Â  Â  } else {
Â  Â  Â  Â  // Ensure mobile-only elements are hidden on desktop (Redundant with CSS but safe)
Â  Â  Â  Â  if (mobileButtonsRow) {
Â  Â  Â  Â  Â  Â  mobileButtonsRow.style.display = 'none';
Â  Â  Â  Â  }
Â  Â  Â  Â  if (mobileResetAllContainer) {
Â  Â  Â  Â  Â  Â  mobileResetAllContainer.style.display = 'none';
Â  Â  Â  Â  }
Â  Â  }
})();


resetGame();
</script>
</body>
</html>
